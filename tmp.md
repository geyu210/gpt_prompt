# 以太坊扩容：区块链的不可能三角

# 深入研究侧链与第二层解决方案如何提升主网性能

同时实现安全性、去中心化和可扩展性这三个特性，是所有区块链的终极目标。但是区块链领域也存在着一个众所周知的不可能三角，就是一条链最多同时实现两个特性，而需要对第三个进行妥协。在以太坊中，安全性与去中心化的优先级高于可扩展性。

以太坊会在随着使用人数的上升而达到瓶颈，而后的交易如果不付出更高的 gas 费，就需要更久的等待。这个负反馈螺旋会阻碍以太坊的扩张。如果通过增加区块容量来扩容，则会减弱其去中心化的程度，这是由于运行以太坊节点（以太坊交易历史的独立副本）的成本会更高。另外，非常大的区块大小可能会破坏共识，从而影响到安全性。为了解决这些挑战，已经出现了各种类型的扩容解决方案，如侧链（Sidechain）与第二层解决方案（Layer 2）。

**侧链**

侧链是独立的区块链，它独立于以太坊主网运行，通过优化其共识算法和区块参数以实现更大的吞吐量。然而，由于侧链的本质是另一条链，其增加的可扩展性是以牺牲安全性和去中心化（不可能三角）为代价的。

!https://s3-us-west-2.amazonaws.com/secure.notion-static.com/94cb7be1-608a-4bc7-8956-db30be370069/0_vp3_hNT70EzqB1TO.png

相比第二层解决方案，侧链不在以太坊上发布状态更改和交易数据，也不继承以太坊的安全性。此外，侧链需要更高的信任假设，且并未实现去信任（trustless security）的目标，这使侧链更容易受到攻击。也容易出现[链重组](https://forum.polygon.technology/t/157-block-reorg-at-block-height-39599624/11388)的情况。

## **第二层解决方案**

依赖以太坊的共识与安全的链下解决方案被归类到 L2。这些解决方案通过在以太坊主网（第一层）之外处理交易来帮助扩展应用，且同时可以受益于以太坊的去中心化安全模型。L2 是独立的区块链，它扩展了以太坊并继承了其安全性。

交易将提交给 L2 节点，而不是 L1，然后最终在 L1 上结算。一旦提交，交易就会由以太坊 L1 保证其安全，同时也无法再修改。不同的 L2 解决方案实现的细节是不同的。

## **状态**通道

状态通道是交易参与者之间的通信环境。

状态通道是一种协议，用户可以在此协议中与对方「链下」交易「x」次，而只需要向以太坊主网提交两次链上交易。该通道使用加密技术来证明最终生成的数据确实是一组有效的中间交易的结果。

每个通道由智能合约管理。参与者需要部署合约并存款以打开通道。链下交易开始后，双方都需要签署一个状态更新。最后关闭通道时，参与者需要在链上提交其最终认可的状态，然后智能合约根据每个参与者在最终状态中的余额分发资金。

状态通道提供了一些优点，如更高的吞吐量，更好的隐私保护，更低的延迟，以及比以太坊主网更低的交易成本。它们在微交易，去中心化应用和根据状态机的最终状态进行的条件付款等场景下非常有用。

状态通道有一些缺点，比如假设所有参与者都必须同时在线并且做好应对纠纷的准备，即使是无效的纠纷，否则就可能会损失他们的资金。参与者数量在状态通道的生命周期内不可变，这也限制了其实用性。

与 Rollup 相比，状态通道的安全性较低，因为它们没有将所有交易数据或状态承诺发布到主网。然而，它们与主网的连通性超过了侧链，使它们相对更安全。

## **Rollup**

 Rollup 是一种将交易计算移到链下，同时将交易数据存储在主网上的 L2 解决方案。这使得 Rollup 能够继承以太坊的原生安全性（原生安全性依赖于以太坊的去中心化）。

下面是 Rollup 的工作方式：数千个交易被收集成一个批次。批次中的所有交易都在链下处理。然后将这些交易的信息打包成一个交易发送到链上。

根据将计算转移到链下的方法，出现了两种类型的 Rollup：乐观型（Optimistic） Rollup 和有效性（Validity） Rollup。

## 乐观型 **Rollup**

乐观型 Rollup 操作会假设批次中的所有交易都是有效的，并且默认不执行任何计算。如果交易被认为无效，任何人都可以在挑战期内生成欺诈证明来挑战交易。成功的欺诈证明会触发对有争议的交易的重新执行，并相应地更新 Rollup 的状态。乐观 Rollup 与 EVM 兼容，并且可以使用原生以太坊工具在其上面构建。

## 有效性 **Rollup**

有效性 Rollup 也被称为零知识 Rollup ，将交易打包成批次并在链下执行。然后，链下证明者为批次中的交易的有效性创建一个有效性证明。有效性证明是加密保证，表明由 Rollup 提出的状态变化是执行某个交易批次的结果。然后，Rollup 操作员会发布描述批次中所有交易的变化的摘要，以及有效性证明。

有效性 Rollup 使用数学证明自动确保交易的完整性并保护协议安全。默认情况下，有效性 Rollup 不与 EVM 兼容，尽管在 Starknet 上存在有效性 Rollup 的编译器。

|  | Optimistic Rollup | Validity (ZK) Rollup |
| --- | --- | --- |
| 验证方式 | 经济激励机制 | 数学 |
| 无效交易处理 | 如果检测到，可以通过运行并提交欺诈证明来质疑 | 无法包含在证明中，也无法在链上提交 |
| 延迟 | 在争议期结束后（通常7天） | 在链上接受证明和状态更新后 |
| 链上存储的数据 | 全部交易数据 | 只有必要的数据（最终余额） |
| EVM兼容性 | 兼容 | 默认不兼容，但存在编译器 |

尽管 Rollup 仍在开发中，并且在某些方面可能不如以太坊安全，但是它们已经在 StarkEx 等项目中展示出了价值与潜力。

StarkWare 的有效性 Rollup 解决方案 StarkEx 已经处理了 392M 笔交易，并且在其所有的 DeFi 与 NFT 的应用中，累计交易量达到了 9070 亿美元。

# **Summary**

# 总结

以太坊用户的增加，会导致其逐渐到达交易的瓶颈，结果就是降低了交易的确认速度并提高了 gas 价格。为了解决这些挑战，已经出现了各种类型的扩容解决方案，如侧链和 Layer 2。

侧链和 Layer 2 都采用类似的扩容方法，将交易执行移到链下。但是侧链负责它们自己的安全，而  Layer 2 继承了以太坊的安全，允许 Layer 2 在不对去中心化和安全性进行妥协的情况下进行扩容。

Rollup 是一种将交易计算移动到链下，同时将交易数据存储在主网上的 Layer 2 解决方案，这使得它们可以继承以太坊的原生安全性。有两种类型的 Rollup：乐观型 Rollup 和有效性 Rollup。

有效性 Rollup 相比于乐观型 Rollup 具有优势，因为它们优先考虑交易的安全性和完整性，要求每一笔交易都在链上进行验证。这确保所有的交易都是有效的，并防止任何欺诈活动的发生。另一方面，乐观型 Rollup 依赖于欺诈证明来检测无效的交易，这可能导致延迟和潜在的安全漏洞。

Starknet 是一个有效性 Rollup ，它使用 STARKs 而不是 SNARKs，这使得它能抵御量子计算机的攻击，并消除了对可信设置的需求。如果有一种程序语言，使你无需理解底层技术就能用 STARKs 扩展应用，会让你心动吗？心动不如行动，今天就开始学习 Starknet 的 Cairo 语言吧！

<aside>
💡 译者注：
原文中的 `Layer 2` 被翻译为`第二层解决方案`，为了易于阅读，译文中又用 `L2` 或 `Layer 2` 代替`第二层解决方案`。

</aside>